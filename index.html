<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDS Adversarial Attack Demo</title>
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent-primary: #3498db; /* Blue */
            --accent-secondary: #f1c40f; /* Yellow */
            --danger: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --info: #2196f3;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
            --card-padding: 24px;
        }

        [data-theme="light"] {
            --bg-primary: #f4f7fc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e8eff7;
            --text-primary: #2c3e50;
            --text-secondary: #576c7a;
            --accent-primary: #3498db;
            --accent-secondary: #f1c40f;
            --danger: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --info: #3498db;
            --shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
        }

        header {
            background-color: var(--bg-secondary);
            padding: 16px 24px;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo i {
            font-size: 1.8rem;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            color: var(--accent-primary);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        main {
            margin-top: 20px;
        }

        .card {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: var(--card-padding);
            margin-bottom: 24px;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        h1, h2, h3, h4 {
            color: var(--accent-primary);
            margin-bottom: 16px;
        }

        h1 {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 32px;
            position: relative;
            padding-bottom: 12px;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 2px;
        }

        h2 {
            font-size: 1.5rem;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--bg-tertiary);
        }

        h3 {
            font-size: 1.25rem;
        }

        p {
            margin-bottom: 16px;
            color: var(--text-secondary);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .tabs {
            display: flex;
            background-color: var(--bg-tertiary);
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 24px;
        }

        .tab-button {
            flex: 1;
            padding: 12px 16px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-family: 'Inter', sans-serif;
        }

        .tab-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .tab-button.active {
            background-color: var(--accent-primary);
            color: #121212;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        input, select {
            width: 100%;
            padding: 12px;
            border-radius: var(--border-radius);
            border: 1px solid var(--bg-tertiary);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
        }

        input:focus, select:focus {
            border-color: var(--accent-primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3); /* Blue shadow */
        }

        button {
            background-color: var(--accent-primary);
            color: #121212;
            border: none;
            border-radius: var(--border-radius);
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        button:hover {
            background-color: #2980b9; /* Darker blue */
            transform: translateY(-2px);
        }

        button:disabled {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        .result-box {
            background-color: var(--bg-tertiary);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-top: 16px;
            margin-bottom: 16px;
        }

        .result-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .result-badge.success {
            background-color: var(--success);
            color: white;
        }

        .result-badge.danger {
            background-color: var(--danger);
            color: white;
        }

        .data-display {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            white-space: pre-wrap; /* Changed from pre to pre-wrap */
            word-wrap: break-word; /* Added for better wrapping */
            padding: 16px;
            background-color: var(--bg-primary);
            border-radius: 4px;
            border: 1px solid var(--bg-tertiary);
        }

        .chart-container {
            width: 100%;
            height: 300px;
            margin: 24px 0;
        }

        .side-by-side {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 768px) {
            .side-by-side {
                grid-template-columns: 1fr;
            }
        }

        .packet-display {
            font-family: 'Roboto Mono', monospace;
            background-color: var(--bg-tertiary);
            padding: 16px;
            border-radius: var(--border-radius);
            overflow-wrap: break-word;
            word-wrap: break-word;
            white-space: pre-wrap;
            font-size: 0.9rem;
            margin-top: 8px;
        }

        .stat-card {
            background-color: var(--bg-tertiary);
            border-radius: var(--border-radius);
            padding: 16px;
            text-align: center;
            margin-bottom: 16px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--bg-tertiary);
        }

        .comparison-table th {
            font-weight: 600;
            color: var(--accent-primary);
        }

        footer {
            text-align: center;
            padding: 24px;
            margin-top: 48px;
            background-color: var(--bg-secondary);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-shield-alt"></i>
            <span>IDS Adversarial Attack Demo</span>
        </div>
        <button id="theme-toggle" class="theme-toggle">
            <i class="fas fa-sun"></i>
        </button>
    </header>

    <div class="container">
        <main>
            <h1>Network Intrusion Detection System Adversarial Robustness</h1>

            <div class="tabs">
                <button class="tab-button active" data-tab="overview">Overview</button>
                <button class="tab-button" data-tab="model">Model</button>
                <button class="tab-button" data-tab="attacks">Adversarial Attacks</button>
                <button class="tab-button" data-tab="robustness">Robustness Analysis</button>
                <button class="tab-button" data-tab="comparison">Comparison</button>
                <button class="tab-button" data-tab="inference">Model Inference</button>
            </div>

            <div id="overview" class="tab-content active">
                <div class="card">
                    <h2>Project Overview</h2>
                    <p>This web application demonstrates how adversarial attacks can bypass Network Intrusion Detection Systems (IDS) and how robust models can defend against these attacks.</p>
                    <h3>Sample Data Records</h3>
                    <div class="data-display" id="sample-data">Loading sample data...</div>
                </div>
            </div>

            <div id="model" class="tab-content">
                <div class="card">
                    <h2>Neural Network Model</h2>
                    <p>We've trained a PyTorch neural network to classify network traffic as normal or intrusive. Below is its performance metrics on the test set.</p>
                    <h3>Model Performance</h3>
                    <div class="grid">
                        <div class="stat-card">
                            <div class="stat-value" id="accuracy">--</div>
                            <div class="stat-label">Accuracy</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="precision">--</div>
                            <div class="stat-label">Precision</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="recall">--</div>
                            <div class="stat-label">Recall</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="f1">--</div>
                            <div class="stat-label">F1 Score</div>
                        </div>
                    </div>

                    <h3>Feature Importance</h3>
                    <p>The relative importance of different features in the model's decision-making process:</p>
                    <div class="chart-container">
                        <canvas id="feature-importance-chart"></canvas>
                    </div>

                    <h3>Confusion Matrix</h3>
                    <div class="chart-container">
                        <canvas id="confusion-matrix-chart"></canvas>
                    </div>
                </div>
            </div>

            <div id="attacks" class="tab-content">
                <div class="card">
                    <h2>Adversarial Attacks</h2>
                    <p>Adversarial attacks generate specially crafted inputs designed to fool the model.</p>

                    <div class="form-group">
                        <label for="attack-type">Select Attack Method:</label>
                        <select id="attack-type">
                            <option value="fgsm">Fast Gradient Sign Method (FGSM)</option>
                            <option value="pgd">Projected Gradient Descent (PGD)</option>
                            <option value="deepfool">DeepFool</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="epsilon">Perturbation Magnitude (Epsilon):</label>
                        <input type="range" id="epsilon" min="0.01" max="0.3" step="0.01" value="0.1">
                        <div id="epsilon-value">0.1</div>
                    </div>

                    <button id="run-attack-btn">Generate Adversarial Examples</button>

                    <div id="attack-results" style="display: none;">
                        <h3>Attack Results</h3>
                        <div class="side-by-side">
                            <div>
                                <h4>Original Sample (Correctly Classified)</h4>
                                <div id="original-sample" class="packet-display"></div>
                                <div id="original-prediction" class="result-badge success"></div>
                            </div>
                            <div>
                                <h4>Adversarial Sample (Misclassified)</h4>
                                <div id="adversarial-sample" class="packet-display"></div>
                                <div id="adversarial-prediction" class="result-badge danger"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="robustness" class="tab-content">
                <div class="card">
                    <h2>Robustness Analysis</h2>
                    <p>Here we compare how a robustly trained model defends against the same adversarial attacks.</p>

                    <div class="form-group">
                        <label for="robust-attack-type">Select Attack Method:</label>
                        <select id="robust-attack-type">
                            <option value="fgsm">Fast Gradient Sign Method (FGSM)</option>
                            <option value="pgd">Projected Gradient Descent (PGD)</option>
                            <option value="deepfool">DeepFool</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="robust-epsilon">Perturbation Magnitude (Epsilon):</label>
                        <input type="range" id="robust-epsilon" min="0.01" max="0.3" step="0.01" value="0.1">
                        <div id="robust-epsilon-value">0.1</div>
                    </div>

                    <button id="test-robust-btn">Test Robust Model</button>

                    <div id="robust-results" style="display: none;">
                        <h3>Robustness Analysis Results</h3>
                        <div class="side-by-side">
                            <div class="stat-card">
                                <div class="stat-value" id="standard-model-accuracy">--</div>
                                <div class="stat-label">Standard Model Accuracy Under Attack</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="robust-model-accuracy">--</div>
                                <div class="stat-label">Robust Model Accuracy Under Attack</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="comparison" class="tab-content">
                <div class="card">
                    <h2>Performance Comparison</h2>
                    <p>This section provides a comprehensive comparison between the standard and robust models across different attack scenarios.</p>

                    <h3>Accuracy Comparison</h3>
                    <div class="chart-container">
                        <canvas id="accuracy-comparison-chart"></canvas>
                    </div>

                    <h3>Detailed Comparison</h3>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Standard Model</th>
                                <th>Robust Model</th>
                            </tr>
                        </thead>
                        <tbody id="comparison-table-body">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="inference" class="tab-content">
                <div class="card">
                    <h2>Model Inference</h2>
                    <p>Click the button below to run inference on a randomly selected sample from the test dataset.</p>

                    <button id="run-inference-btn">Run Inference on Random Sample</button>

                    <div id="inference-results" style="display: none;">
                        <h3>Inference Results</h3>
                        <div class="result-box">
                            <h4>Original Sample Data:</h4>
                            <pre id="original-inference-sample" class="data-display"></pre>
                        </div>
                        <div class="side-by-side">
                            <div>
                                <h4>Standard Model Prediction</h4>
                                <div id="standard-inference-prediction" class="result-badge"></div>
                                <div id="standard-inference-confidence"></div>
                            </div>
                            <div>
                                <h4>Robust Model Prediction</h4>
                                <div id="robust-inference-prediction" class="result-badge"></div>
                                <div id="robust-inference-confidence"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <footer>
        <p>IDS Adversarial Attack Demo &copy; 2025 | Created for educational purposes</p>
    </footer>

    <script>
        let featureImportanceChart = null;
        let confusionMatrixChart = null;
        let accuracyComparisonChart = null;

        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const htmlElement = document.documentElement;

        themeToggle.addEventListener('click', () => {
            const currentTheme = htmlElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            htmlElement.setAttribute('data-theme', newTheme);
            const icon = themeToggle.querySelector('i');
            icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('theme', newTheme);
        });

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            htmlElement.setAttribute('data-theme', savedTheme);
            const icon = themeToggle.querySelector('i');
            icon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        // Tab functionality
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === tabId) {
                        content.classList.add('active');
                    }
                });
            });
        });

        // Epsilon sliders
        const epsilonInput = document.getElementById('epsilon');
        const epsilonValue = document.getElementById('epsilon-value');
        const robustEpsilonInput = document.getElementById('robust-epsilon');
        const robustEpsilonValue = document.getElementById('robust-epsilon-value');

        epsilonInput.addEventListener('input', () => {
            epsilonValue.textContent = epsilonInput.value;
            robustEpsilonInput.value = epsilonInput.value;
            robustEpsilonValue.textContent = epsilonInput.value;
        });

        robustEpsilonInput.addEventListener('input', () => {
            robustEpsilonValue.textContent = robustEpsilonInput.value;
            epsilonInput.value = robustEpsilonInput.value;
            epsilonValue.textContent = robustEpsilonInput.value;
        });

        // Load initial data
        function loadSampleData() {
            fetch('/sample_data')
                .then(response => response.json())
                .then(data => {
                    const sampleDataEl = document.getElementById('sample-data');
                    let sampleHtml = '';
                    data.samples.forEach((sample, index) => {
                        sampleHtml += `<div>${index + 1}. ${sample}</div>`;
                    });
                    sampleDataEl.innerHTML = sampleHtml;
                });
        }

        function loadModelInfo() {
            fetch('/model_info')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('accuracy').textContent = (data.accuracy * 100).toFixed(2) + '%';
                    document.getElementById('precision').textContent = (data.precision * 100).toFixed(2) + '%';
                    document.getElementById('recall').textContent = (data.recall * 100).toFixed(2) + '%';
                    document.getElementById('f1').textContent = (data.f1 * 100).toFixed(2) + '%';
                    renderFeatureImportanceChart(data.feature_importance);
                    renderConfusionMatrix(data.confusion_matrix);
                });
        }

        function renderFeatureImportanceChart(featureImportance) {
            if (featureImportanceChart) featureImportanceChart.destroy();
            const ctx = document.getElementById('feature-importance-chart').getContext('2d');
            const sortedFeatures = Object.entries(featureImportance).sort((a, b) => b[1] - a[1]).slice(0, 10);
            featureImportanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedFeatures.map(f => f[0]),
                    datasets: [{
                        label: 'Feature Importance',
                        data: sortedFeatures.map(f => f[1]),
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: '#3498db',
                        borderWidth: 1
                    }]
                },
                options: { indexAxis: 'y', responsive: true, plugins: { legend: { display: false } } }
            });
        }

        function renderConfusionMatrix(confusionMatrix) {
            if (confusionMatrixChart) confusionMatrixChart.destroy();
            const ctx = document.getElementById('confusion-matrix-chart').getContext('2d');
            const data = {
                labels: ['Normal', 'Intrusion'],
                datasets: [{
                    label: 'Confusion Matrix',
                    data: [
                        {x: 'Predicted Normal', y: 'Actual Normal', v: confusionMatrix[0][0]},
                        {x: 'Predicted Intrusion', y: 'Actual Normal', v: confusionMatrix[0][1]},
                        {x: 'Predicted Normal', y: 'Actual Intrusion', v: confusionMatrix[1][0]},
                        {x: 'Predicted Intrusion', y: 'Actual Intrusion', v: confusionMatrix[1][1]}
                    ],
                    backgroundColor: function(context) {
                        const value = context.dataset.data[context.dataIndex].v;
                        const max = Math.max(...confusionMatrix.flat());
                        const opacity = 0.3 + 0.7 * (value / max);
                        if (context.dataIndex === 0) return `rgba(46, 204, 113, ${opacity})`; // TN (Green)
                        if (context.dataIndex === 1) return `rgba(241, 196, 15, ${opacity})`; // FP (Yellow)
                        if (context.dataIndex === 2) return `rgba(231, 76, 60, ${opacity})`; // FN (Red)
                        if (context.dataIndex === 3) return `rgba(52, 152, 219, ${opacity})`; // TP (Blue)
                    }
                }]
            };
            // Custom chart type for matrix
            Chart.register({
                id: 'matrix',
                defaults: {},
                controllers: {
                    matrix: Chart.controllers.bar
                }
            });
            confusionMatrixChart = new Chart(ctx, {
                type: 'matrix',
                data: data,
                options: {
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const item = context.dataset.data[context.dataIndex];
                                    return `${item.y}, ${item.x}: ${item.v}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Predicted' } },
                        y: { title: { display: true, text: 'Actual' } }
                    }
                }
            });
        }

        document.getElementById('run-attack-btn').addEventListener('click', function() {
            const attackType = document.getElementById('attack-type').value;
            const epsilon = document.getElementById('epsilon').value;
            fetch('/run_attack', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ attack_type: attackType, epsilon: parseFloat(epsilon) })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('attack-results').style.display = 'block';
                document.getElementById('original-sample').textContent = data.original_sample;
                document.getElementById('adversarial-sample').textContent = data.adversarial_sample;
                document.getElementById('original-prediction').textContent = `Predicted: ${data.original_prediction}`;
                document.getElementById('adversarial-prediction').textContent = `Predicted: ${data.adversarial_prediction}`;
                document.getElementById('original-prediction').className = `result-badge ${data.original_prediction === data.true_label ? 'success' : 'danger'}`;
                document.getElementById('adversarial-prediction').className = `result-badge ${data.adversarial_prediction === data.true_label ? 'success' : 'danger'}`;
            });
        });

        document.getElementById('test-robust-btn').addEventListener('click', function() {
            const attackType = document.getElementById('robust-attack-type').value;
            const epsilon = document.getElementById('robust-epsilon').value;
            fetch('/test_robust_model', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ attack_type: attackType, epsilon: parseFloat(epsilon) })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('robust-results').style.display = 'block';
                document.getElementById('standard-model-accuracy').textContent = `${(data.standard.accuracy * 100).toFixed(2)}%`;
                document.getElementById('robust-model-accuracy').textContent = `${(data.robust.accuracy * 100).toFixed(2)}%`;
                updateComparisonTable(data.comparison_data);
                renderAccuracyComparisonChart(data.comparison_data);
            });
        });

        function updateComparisonTable(comparisonData) {
            const tableBody = document.getElementById('comparison-table-body');
            tableBody.innerHTML = '';
            const attacks = ['fgsm', 'pgd', 'deepfool'];
            attacks.forEach(attack => {
                const standardAcc = comparisonData.standard[`${attack}_accuracy`] || 0;
                const robustAcc = comparisonData.robust[`${attack}_accuracy`] || 0;
                const epsilon = comparisonData.standard[`${attack}_epsilon`] || 'N/A';
                const row = `
                    <tr>
                        <td>${attack.toUpperCase()} Accuracy (Îµ=${epsilon})</td>
                        <td>${(standardAcc * 100).toFixed(2)}%</td>
                        <td>${(robustAcc * 100).toFixed(2)}%</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        function renderAccuracyComparisonChart(comparisonData) {
            if (accuracyComparisonChart) accuracyComparisonChart.destroy();
            const ctx = document.getElementById('accuracy-comparison-chart').getContext('2d');
            const attacks = ['fgsm', 'pgd', 'deepfool'];
            accuracyComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: attacks.map(a => a.toUpperCase()),
                    datasets: [
                        {
                            label: 'Standard Model',
                            data: attacks.map(a => (comparisonData.standard[`${a}_accuracy`] || 0) * 100),
                            backgroundColor: 'rgba(231, 76, 60, 0.7)',
                        },
                        {
                            label: 'Robust Model',
                            data: attacks.map(a => (comparisonData.robust[`${a}_accuracy`] || 0) * 100),
                            backgroundColor: 'rgba(46, 204, 113, 0.7)',
                        }
                    ]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true, max: 100, title: { display: true, text: 'Accuracy (%)' } }
                    }
                }
            });
        }

        document.getElementById('run-inference-btn').addEventListener('click', function() {
            fetch('/run_inference', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                document.getElementById('inference-results').style.display = 'block';
                document.getElementById('original-inference-sample').textContent = data.original_sample_raw;
                document.getElementById('standard-inference-prediction').textContent = `Predicted: ${data.standard_prediction}`;
                document.getElementById('standard-inference-confidence').textContent = `Confidence: ${(data.standard_confidence * 100).toFixed(2)}%`;
                document.getElementById('robust-inference-prediction').textContent = `Predicted: ${data.robust_prediction}`;
                document.getElementById('robust-inference-confidence').textContent = `Confidence: ${(data.robust_confidence * 100).toFixed(2)}%`;
                document.getElementById('standard-inference-prediction').className = `result-badge ${data.standard_prediction === 'normal' ? 'success' : 'danger'}`;
                document.getElementById('robust-inference-prediction').className = `result-badge ${data.robust_prediction === 'normal' ? 'success' : 'danger'}`;
            });
        });

        window.addEventListener('load', () => {
            loadSampleData();
            loadModelInfo();
        });
    </script>
</body>
</html>
